From 8bcc67c0ab7fe84bb0a1ac4baa3eeb5f76203c5e Mon Sep 17 00:00:00 2001
From: "sanjaikumar.vs" <sanjaikumar.vs@dicortech.com>
Date: Fri, 3 Mar 2023 11:24:50 +0530
Subject: [PATCH] Adding suppport for Wifi

---
 .../boot/dts/freescale/imx8qxp-celeritas.dtsi | 66 +++++++++++++++++++
 arch/arm64/configs/imx_v8_defconfig           |  6 ++
 10 files changed, 144 insertions(+), 13 deletions(-)

diff --git a/arch/arm64/boot/dts/freescale/imx8qxp-celeritas.dtsi b/arch/arm64/boot/dts/freescale/imx8qxp-celeritas.dtsi
index dfbccbecee1a..6938f5993648 100644
--- a/arch/arm64/boot/dts/freescale/imx8qxp-celeritas.dtsi
+++ b/arch/arm64/boot/dts/freescale/imx8qxp-celeritas.dtsi
@@ -333,6 +345,36 @@
 	status = "okay";
 };
 
+&usdhc2 {
+		#address-cells = <1>;
+		#size-cells = <0>;
+	assigned-clocks = <&clk IMX_SC_R_SDHC_1 IMX_SC_PM_CLK_PER>;
+	assigned-clock-rates = <200000000>;
+	pinctrl-names = "default", "state_100mhz", "state_200mhz";
+	pinctrl-0 = <&pinctrl_usdhc2>, <&pinctrl_usdhc2_gpio>;
+	pinctrl-1 = <&pinctrl_usdhc2>, <&pinctrl_usdhc2_gpio>;
+	pinctrl-2 = <&pinctrl_usdhc2>, <&pinctrl_usdhc2_gpio>;
+	bus-width = <4>;
+	vmmc-supply = <&reg_usdhc2_vmmc>;
+	status = "okay";
+	drv-type = <2>;
+	cap-sd-highspeed;
+	sd-uhs-sdr50;
+	sd-uhs-sdr104;
+	keep-power-in-suspend;
+	enable-sdio-wakeup;
+	cap-sdio-irq;
+	non-removable;
+	no-mmc;
+	no-sd;
+	qca_wifi: qca-wifi@1 {
+		#address-cells = <1>;
+		#size-cells = <0>;
+		compatible = "qcom,ath10k";
+		reg = <1>;
+	};
+};
+
 &vpu {
 	compatible = "nxp,imx8qxp-vpu";
 	status = "okay";
@@ -520,4 +568,22 @@
 		>;
 	};
 
+	pinctrl_usdhc2_gpio: usdhc2gpiogrp {
+		fsl,pins = <
+			IMX8QXP_USDHC1_RESET_B_LSIO_GPIO4_IO19     0x00000021
+		>;
+	};
+
+
+	pinctrl_usdhc2: usdhc2grp {
+		fsl,pins = <
+			IMX8QXP_USDHC1_CLK_CONN_USDHC1_CLK			0x06000041
+			IMX8QXP_USDHC1_CMD_CONN_USDHC1_CMD			0x00000021
+			IMX8QXP_USDHC1_DATA0_CONN_USDHC1_DATA0			0x00000021
+			IMX8QXP_USDHC1_DATA1_CONN_USDHC1_DATA1			0x00000021
+			IMX8QXP_USDHC1_DATA2_CONN_USDHC1_DATA2			0x00000021
+			IMX8QXP_USDHC1_DATA3_CONN_USDHC1_DATA3			0x00000021
+		>;
+	};
+
 };
diff --git a/arch/arm64/configs/imx_v8_defconfig b/arch/arm64/configs/imx_v8_defconfig
index 97dc633d7800..23fc118ba14b 100644
--- a/arch/arm64/configs/imx_v8_defconfig
+++ b/arch/arm64/configs/imx_v8_defconfig
@@ -1067,3 +1067,9 @@ CONFIG_TRUSTED_KEYS_CAAM=y
 
 CONFIG_SOC_IMX9=y
 CONFIG_ETHOSU=y
+
+CONFIG_ATH10K=y
+CONFIG_ATH10K_CE=y
+CONFIG_ATH10K_SDIO=y
+CONFIG_ATH_COMMON=y
+CONFIG_WLAN_VENDOR_ATH=y
